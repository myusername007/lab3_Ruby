# Лабораторна робота №3

**Тема: Створення і розгортання повноцінного проєкту**

**Мета: Розробити повноцінний функціонал вебзастосунку. Зрозуміти принципи роботи з базою даних. Освоїти процес аутентифікації та авторизації**

## 1. Розробка

### 1.1. Згенерувати Ruby on Rails додаток

Створити новий проєкт виконавши команду `rails new` 

### 1.2. Підклюення ґема Devise для авторизації

1. Перейшовши на [офіційний сайт Devise](https://github.com/heartcombo/devise) ознайомитися з описом ґема.
2. Додати `gem 'devise'` до файлу **Gemfile** - додавання ґема до проєкту
3. Запустити команду `bundle install` - інсталяція ґема та оновлення **Gemfile.lock**
4. Ініціалізувати ґем devise за допомогою вбудованого генератора командою `rails generate devise:install`
5. Зверніть увагку на згенеровані файли.
Devise додає великий функціонал що стосується авторизації, в тому числі шифрування паролей, валідації, а також представлення, контроллери та електронні листи (mailers).
6. Для коректного функціонування листів, необхідно налаштувати URL адресу (домен) сайту, звідки надсилаються листи, а також куди будуть адресуватися посилання з листів
Для цього необхідно у файл `config/environments/development.rb` додати відповідну конфігурацію, наприклад:
```ruby
config.action_mailer.default_url_options = { host: 'localhost', port: 3000 }
```
7. Згенерувати модель користувача генератором, що вбудований у Devise, за допомогою команди `rails generate devise User`
8. Зверніть увагу на згенеровані файли.
9. Наступник кроком необхідно запустити міграційні файли, за допомогою команди `rails db:migrate`

* Ознайомтеся з методами, які додає цей ґем - https://github.com/heartcombo/devise?tab=readme-ov-file#controller-filters-and-helpers

** Ознайомтеся зі списком шляхів (Routes) які зʼявилися після додавання ґему за допомогою команди `rails routes` 

*** Для генерації файлів представлень Devise існують відповідні команди описані у відповідному розділі https://github.com/heartcombo/devise?tab=readme-ov-file#configuring-views

### 1.3. Підключення Bootstrap

Ознайомитися з [інструкцією](https://github.com/twbs/bootstrap-rubygem/blob/main/README.md#a-ruby-on-rails) та виконати кроки описані в ній.

### 1.4. Тематичний сайт

Розробити тематичний сайт, наприклад, додавання\редагування\видалення замків України

## 2. Деплой

### 2.0 Вибір Вебхостингу

Для виконання лабораторної роботи **можна використовувати будь-який хостинг** Ruby on Rails додатків.
Однак в даній частині буде описано використання безкоштовного хостингу від Render.com

### 2.1. Підготовка до деплою

1. У файлі `Gemfile` необхідно додати до групи **production** (додати, за її відсутності) ґем `pg`.
А ґем `sqlite3` перенести з глобальної секції у групу **development та test**.
Це дасть можливість використовувати різні СКБД у різних середовищах: SQLite у локальному середовищі при розробці, а PostgreSQL у середовищі для кінцевого користувача.
Після зміни `Gemfile` необхідно завжди запускати команду `bundle install`
2. У файлі `config/database.yml` секція **production** повинна виглядати наступним чином:
```yaml
production:
  url: <%= ENV['DATABASE_URL'] %>
```

### 2.2. Деплой (на Render.com)

# УВАГА! НЕ заповнюйте свої платіжні дані. Інакше, у випадку використання ліміту обмежень може стягуватися додаткова плата сервісом.

#### 2.2.0. Необхідно зареєструватися, рекомендовано використовувати пошту в домені університету, зокрема обліковий запис Google
<img width="75%" src="./images/login.png">

#### 2.2.1. Після Авторизації буде видно головну сторінку.
<img width="75%" src="./images/dashboard_empty.png">

#### 2.2.2. Створення проєкту, як області (обʼєднання) компонентів.
<img width="75%" src="./images/dashboard_new_project.png">
<img width="75%" src="./images/project_new.png">

#### 2.2.3. Створення серверу для бази даних (Важливо, щоб при створенні був обраний Free (безкоштовний) план)
<img width="75%" src="./images/db_new.png">
<br>
Також, добре вибрати було б регіон у якому розташовується сервер, аби це було як найближче до кінцевого користувача, для зменшення затримки.
<br>
<img width="75%" src="./images/db_new_form.png">

* Важливо! Безкоштовна база даних існує тільки протягом 30 днів. - Цього достатньо для тестування і вивчення матеріалу. 

<img width="75%" src="./images/db_show.png">


#### 2.2.4 Скопіювати URL адресу для доступу до бази даний (Увага! вона містить логін і пароль користувача бази даних)

<img width="75%" src="./images/db_url.png">

#### 2.2.5. Необхідно Ruby on Rails проєкт завантажити на репозиторій GitHub створений в контексті виконання даної лабораторної роботи.

#### 2.2.6. Створення серверу для вебдодатку.
Увага! Безкоштовний тарифний план передбачає обмеження, зокрема якщо сайт не отримував запити від користувачів, то він після 30 хвилин бездіяльності вимикається, однак після наступного запиту від користувача він буде вмикатися автоматично орієнтовно 1 хвилину.

<img width="75%" src="./images/web_new.png">

Оскільки  репозиторій є приватним, тому необхідно надати доступ хостингу саме до цього репозиторію. 
<br>
<img width="75%" src="./images/web_new_2.png">
<br>
<img width="75%" src="./images/web_new_3.png">
<br>
<img width="75%" src="./images/web_new_4.png">
<br>
Після натискання на кнопку Connect зʼявиться вебформа, важливо заповнити деякі поля наступним чином:
- Language: `Ruby`
- Branch - гілка в Git-репозиторії яка буде відслідковуватися хостингом і у випадку оновлень буде автоматично відбуватися процес Деплою (оновлення кінцевого сайту)
- Build command: Тут необхідно додати в кінець команду для запуску міграцій `rails db:migrate`, загальний вигляд повинен бути таким: `bundle install; bundle exec rake assets:precompile; bundle exec rake assets:clean; rails db:migrate;`
- **Знову ж таки необхідно обрати Free (безкоштовний) тарифний план**
- У секції Environment Variables, поле RAILS_MASTER_KEY повинне бути заповнене ключем, який можна отримати у локальному проєкті `config/master.key` - цей файл ігнорується Git у цілях безпеки.
- У секції Environment Variables, необхідно додати нове поле з назвою DATABASE_URL (з пункту 2.1. 1) та встановити його значення як URL адресу отриману в пункті 2.2.4.
<br>
<img width="75%" src="./images/web_new_form.png">
<br>
Далі, натискаємо Deploy Web Service і переглядаємо журнали Деплою.
Деплой включає в себе такі етапи: Викачування проєкту з Git-репозиторію, налаштовування сервера (інсталяція Ruby та додаткових пакетів) в результаті чого утворюється Build (зліпок системи)
У випадку якщо після змін в коді не буде працювати сайт, то можна буде відновити один з попередніх Buildʼів, аби користувачі могли користуватися попередньою версією сайту, поки нова версія не буде виправлена, аби не переривати роботу користувачів на сайті. 
<br>
<img width="75%" src="./images/web_show.png">


#### 2.2.7. Після успішного деплою буде відповідний статус "Live". Та можливість перейти на сайт (виділено посилання червоним).
<img width="75%" src="./images/web_success.png">

### 2.3. Перевірка та огляд

Далі необхідно перейти на сайт, та перевірити змінений функціонал, оскільки це був перший деплой, то необхідно переглянути ВЕСЬ функціонал сайту і переконатися що він працює коректно.
